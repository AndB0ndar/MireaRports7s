\section*{ЦЕЛЬ ПРАКТИЧЕСКОЙ РАБОТЫ}
\addcontentsline{toc}{section}{ЦЕЛЬ ПРАКТИЧЕСКОЙ РАБОТЫ}

План практической работы:

\begin{itemize}
	\item Подключение внешних зависимостей;
	\item Версионирование зависимостей;
	\item Кеширование изображений из сети;
	\item Выполнение практической работы \No\,8.
\end{itemize}

\clearpage

\section*{ВЫПОЛНЕНИЕ ПРАКТИЧЕСКОЙ РАБОТЫ}
\addcontentsline{toc}{section}{ВЫПОЛНЕНИЕ ПРАКТИЧЕСКОЙ РАБОТЫ}

\section{Подключение внешних зависимостей}

Ранее в практических работах мы уже сталкивались
с подключением внешних пакетов в собственное приложение.
Для этого используется ранее рассмотренный\texttt{pubspec.yaml} 
и его \texttt{dependency} и \texttt{dev\_dependency}.
Для добавления зависимости в проект используется поле dependencies
в файле \texttt{pubspec.yaml}, под ним указывается название библиотеки,
её источник и версия, если она обязательна для выбранного типа источника.
Зависимости бывают четырёх видов с точки зрения источников.

\subsection{Зависимости из облака}

Когда мы говорим о библиотеках во Flutter,
сразу вспоминается популярный ресурс --- \texttt{pub.dev}.
Данный сайт --- официальный репозиторий пакетов для Dart и Flutter,
он предоставляет разработчикам доступ к широкому спектру пакетов,
которые могут использоваться для Flutterпроектов.
На нём размещены пакеты, созданные сообществом Dart и Flutter,
а также пакеты, разработанные и поддерживаемые самой командой Google.

Страница каждого пакета содержит его название,
актуальную версию, дату публикации, автора и другую информацию,
которая может быть полезна при использовании пакета.
Ниже представлен скриншот страницы
библиотеки \texttt{sqflite} версии 2.4.0 \rref{fig:pub}.
Можно увидеть, что она была выбрана
как Flutter Favorite --- это одна из <<наград>> на сайте,
которая говорит о высочайшем качестве библиотеки.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 19-30-09}
	\caption{Страница библиотеки sqflite}
	\label{fig:pub}
\end{image}

Для подключения зависимости,
которая была опубликована на сайте \texttt{pub.dev},
официальном публичном репозитории библиотек для Dart и Flutter,
требуется указать ее имя и, при необходимости, версию пакета,
как изображено на рисунке~\ref{fig:dev:pub}.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 19-33-39}
	\caption{Подключение зависимости из pub.dev}
	\label{fig:dev:pub}
\end{image}

\subsection{Зависимости Git}

Иногда приходится брать зависимости не из официальных источников.
Для этого часто используются пкеты,
расположенные в облачный системах контроля версий:
GitHub, GitLab, Bitbucket и другие.
При подключении зависимости из Git-а требуется указать
в обязательном порядке маршрут до пакета, а также ветку или коммит,
который требуется подключить.
Полный синтаксис подключения пакета из Git-а
можно увидеть на рисунке~\ref{fig:dev:git}.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 19-51-24}
	\caption{Подключение зависимости из Git}
	\label{fig:dev:git}
\end{image}

\subsection{Локальные зависимости}

Бывают зависимости, которые настолько не большие,
что выносить их в отдельное пространство нет никакого смысла.
Такие зависимости становятся локальными.
Они все еще являются отдельными пакетами,
но располагаются внутри самого приложения.
А если зависимость лежит в локальной файловой системе приложения,
то и устанавливаться она может локально.
Для этого нужно прописать полный или относительный путь до этой зависимости.

Для примера клонируем репозиторий библиотеки
для кэширования сетевых изображений
\texttt{flutter\_cached\_network\_image}
командой, показаной в листинге~\ref{lst:git:clone}.

\begin{lstlisting}[
	language=bash
	, caption=\leftline{Клонирование репозитория}
	, label=lst:git:clone
	]
git clone https://github.com/Baseflow/flutter_cached_network_image.git
\end{lstlisting}

Подключение локальной зависимости во Flutter проект
показано на рисунке~\ref{fig:dev:local}.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 19-55-31}
	\caption{Подключение локальной зависимости}
	\label{fig:dev:local}
\end{image}

\section{Версионирование зависимостей}

Ранее говорилось, что для подключения пакета
в приложение требуется указать его версию.
Для определения версии пакета в Dart используется семантическое
версионирование, которое состоит из трёх чисел,
разделённых точками: <<мажор.минор.патч>>.
Каждое из чисел обозначает различные изменения в пакете:

\begin{itemize}
	\item мажор (основная версия) --- изменения в API,
		которые обратно несовместимы (англ. breaking changes).
		Такие изменения могут повлиять на существующий код,
		который использует предыдущую версию библиотеки,
		и могут потребовать изменений или модификаций в этом коде,
		чтобы он продолжал работать с новой версией;
	\item минор (англ. minor) --- добавление новой функциональности
		в существующее API, которое не нарушает обратную совместимость;
	\item патч (англ. patch) --- исправление ошибок в пакете,
		которые не влияют на API.
\end{itemize}

В Dart можно использовать операторы версионирования
для указания ограничений версий зависимостей.
Операторы версионирования, которые также называют констрейнтами,
включают в себя следующие:

\begin{itemize}
	\item any --- используется для указания того,
		что проект совместим со всеми версиями зависимости.
		Это означает, что проект может использовать любую версию зависимости,
		которая доступна на момент установки;
	\item x.y.z --- установится версия x.y.z,
		где x — мажор, y — минор, а z — патч;
	\item >x.y.z --- установится максимально возможная версия из тех,
		что выше x.y.z;
	\item >=x.y.z --- установится максимально возможная версия из тех,
		что выше, или равная версии x.y.z;
	\item <x.y.z --- установится максимально возможная версия из тех,
		что ниже x.y.z;
	\item <=x.y.z --- установится максимально возможная версия из тех,
		что ниже, или равная версии x.y.z;
	\item \verb|^|x.y.z --- расшифровывается как >= x.y.z < (x+1).0.0.
		\verb|^|1.2.3 эквивалентно >= 1.2.3 < 2.0.0.
		Однако для версий с мажором, равным нулю,
		работает по-другому: \verb|^|0.1.2 эквивалентно >= 0.1.2 < 0.2.0.
		Если мажор равен нулю, то библиотека ещё в бетаверсии
		и любые минорные изменения могут быть обратно несовместимы.
\end{itemize}

\section{Кеширование изображений из сети}

Если приложению требуется демонстрировать одно или несколько изображений,
размещенных на интернет-сервере,
обычно разумно временно кэшировать эти изображения.
Это избавит от необходимости многократно загружать
их по мере навигации пользователя по вашему приложению.\par
Например, рассмотрим социальную сеть,
где пользователи могут просматривать свою ленту новостей,
просматривать сведения о публикациях и сохранять публикации в избранном.
Теперь рассмотрим последствия многократной загрузки одного
и того же изображения.
Если бы пользователю приходилось загружать миниатюру каждый раз,
когда он просматривал список сообщений,
получал доступ к сведениям о сообщении или просматривал список избранного,
это приводило бы к ненужному использованию сетевых ресурсов
и перегрузке сервера.
Более того, пользователю придется каждый раз ждать загрузки изображения,
что приводит к неприятностям.\par
По этой причине Flutter имеет встроенный механизм,
позволяющий управлять файлами в определенном каталоге,
предназначенном для временных файлов.
Основная цель этого каталога --- хранить временные данные,
которые могут быть восстановлены приложением в случае их удаления.
Цель этого каталога --- улучшить общую производительность
или каким-либо образом улучшить взаимодействие с пользователем.
Тем не менее, управление этими файлами может быть скучным и утомительным.
Чтобы упростить этот процесс, у нас есть пакет \texttt{cached\_network\_image},
который абстрагирует нас от управления кэш-памятью.\par
Этот пакет позаботится о загрузке изображения в первый раз,
сохранит его в кеше и извлечет его оттуда,
если то же изображение будет запрошено снова.

\subsection{Подключение в проект}

Для подключения пакета \texttt{cached\_network\_image}
в проект требуется в файл \texttt{pubspec.yaml}
добавить пакет в \texttt{dependency}.
Пример добавления \texttt{cached\_network\_image} версии \verb|^|3.4.1
изображен на рисунке~\ref{fig:dev:cached:network:image}.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 20-11-58}
	\caption{Добавления пакета cached\_network\_image в приложение}
	\label{fig:dev:cached:network:image}
\end{image}

Альтернативным вариантом является введение команды
\texttt{flutter pub add cached\_network\_image} в терминале,
смотрящим в директорию проекта.

\subsection{Отображение картинки}

Пакет \texttt{cached\_network\_image} предоставляет доступ
к Widget-у \texttt{CachedNetworkImage}.
Данный Widget создан для отображения изображения
из сети интернет с последующим его кешированием.
Для установки искомого изображения необходимо передать сетевой маршрут
до него в аргумент Widget-а \texttt{imageUrl}.
При первом \texttt{CachedNetworkImage} запросе на рендеринг этого изображения
он загрузит его из Интернета и сохранит,
а затем будет извлекать его из кеша.
Пример использования \texttt{CachedNetworkImage}
изображен на рисунке~\ref{fig:use:cni}.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 20-16-13}
	\caption{Пример использования CachedNetworkImage}
	\label{fig:use:cni}
\end{image}

\section{Приложение}

Переработаем имеющееся приложение,
выполненное на предыдущих практических работах, таким образом,
чтобы в нем было не менее 5 сетевых картинок,
отображаемых как при подключении к сети интернет, так и без него.

\subsection{Изменение API приложения}

Для демонстрации загрузки сетевых картинок
изменим написанное в предыдущей практике API (Листинг~\ref{lst:api}).\par
Изменина модель Task. В нее добавлено поле image,
хранящее название файла изображение.\par
Тажке добавлена функция \texttt{get\_image},
которая позволяет получать изображение по его идентификатору.
Она проверяет наличие изображения с разными расширениями
(без расширения, .png, .jpg).
Эта функция также обрабатывает отсутствие изображения
и возвращает соответствующее сообщение об ошибке.\par
Для примера, в конце кода добавляется инициализация списка задач
с помощью цикла, создающего пять предустановленных задач,
каждая из которых ссылается на существующее изображения (от 1.png до 5.png),
хранящиеся в каталоге \texttt{images}.

\lstinputlisting[
	language=bash, firstline=75, lastline=89,
	caption=\leftline{Измененный код API приложения},
	label=lst:api
	]{8/src/main.py}

\subsection{Установка зависимости}

Пакет \texttt{http} во Flutter нужен для выполнения HTTP-запросов.
Он предоставляет набор высокоуровневых функций и классов,
которые упрощают работу с HTTP-ресурсами.

Некоторые методы, которые доступны в этой библиотеке:

\begin{itemize}
	\item GET --- для получения данных с сервера;
	\item POST --- для отправки данных на сервер;
	\item PUT --- для обновления данных на сервере;
	\item DELETE --- для удаления данных с сервера.
\end{itemize}

Для использования пакета \texttt{cached\_network\_image}
(версия \verb|^|3.4.1) в проекте, сначала его нужно прописать
в зависимостях к проекту \rref{fig:cached:network:image}.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 20-11-58}
	\caption{Установка зависимости cached\_network\_image}
	\label{fig:cached:network:image}
\end{image}

\subsection{TaskDetailScreen}

Чтобы отобразить изображение изменим
экран \texttt{TaskDetailScreen} \rref{fig:screen:detail}.
Для этого будем использовать виджет \texttt{CachedNetworkImage},
данный Widget создан для отображения изображения
из сети интернет с последующим его кешированием.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 20-44-19}
	\caption{Код TaskDetailScreen}
	\label{fig:screen:detail}
\end{image}

В теле виджета \texttt{Column} добавлен виджет \texttt{CachedNetworkImage},
который загружает изображение по URL.\par
Передаваемое этому виджету URL будем получать из конкатенации
строки конкатенация\texttt{http://127.0.0.1:8000/images/} и
названия файла, получаемого из поля \texttt{image} объекта \texttt{Task}.\par
Если загрузка изображения занимает время,
показывается \texttt{CircularProgressIndicator},
а если загрузка не удалась, отображается иконка ошибки.
Указано его обтекание с помощью \texttt{BoxFit.cover}.\par
CachedNetworkImage автоматически кэширует изображения после первого запроса,
что позволяет быстрее загружать их в будущем и отображать в оффлайн-режиме.
Если изображение первоначально не загружено (например, из-за отсутствия сети),
будет показана иконка ошибки.

\subsection{Работа приложения}

Для демонстрации работы приложения,
которое отображает 5 сетевых картинок,
созданного на Flutter с использованием кэширования изображений,
покажем все используемые экраны.

На рисунке~\ref{fig:screen:list} показана страница со списком задач,
на которые можно нажать для получения более подробной информации о них.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 20-48-32}
	\caption{Экран списка задач}
	\label{fig:screen:list}
\end{image}

На рисунке~\ref{fig:task:0} показана страница с задачей,
в которой прикреплено изображение с ER-диаграммой.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 20-48-36}
	\caption{Задача с ER-диаграммой}
	\label{fig:task:0}
\end{image}

На рисунке~\ref{fig:task:1} показана страница с задачей,
в которой прикреплено изображение с диаграммой состояний.

\begin{image}
	\includegrph[scale=0.32]{Screenshot from 2024-10-19 20-48-47}
	\caption{Задача с диаграммой состояний}
	\label{fig:task:1}
\end{image}

На рисунке~\ref{fig:task:2} показана страница с задачей,
в которой прикреплено изображение с диаграммой компонентов.

\begin{image}
	\includegrph[scale=0.32]{Screenshot from 2024-10-19 20-48-53}
	\caption{Задача с диаграммой компонентов}
	\label{fig:task:2}
\end{image}

На рисунке~\ref{fig:task:3} показана страница с задачей,
в которой прикреплено изображение с Venn-диаграммой.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 20-48-59}
	\caption{Задача с Venn-диаграммой}
	\label{fig:task:3}
\end{image}

На рисунке~\ref{fig:task:4} показана страница с задачей,
в которой прикреплено изображение с C4-диаграммой.

\begin{image}
	\includegrph{Screenshot from 2024-10-19 20-49-13}
	\caption{Задача с C4-диаграммой}
	\label{fig:task:4}
\end{image}

\clearpage

\section*{ВЫВОД}
\addcontentsline{toc}{section}{ВЫВОД}

В ходе выполнения практической работы
была успешно достигнута основная цель --- разработка мобильного приложения
на Flutter, которое отображает сетевые изображения
и функционирует как в режиме онлайн, так и оффлайн.
Основные шаги, выполненные в процессе работы, включали:

\begin{itemize}
	\item Подключение внешних зависимостей:
		Использование пакета\texttt{cached\_network\_image} 
		обеспечило возможность кэширования изображений,
		что улучшило производительность приложения.
	\item Версионирование зависимостей:
		Фиксация версий зависимостей позволила избежать
		потенциальных конфликтов и ошибок, связанных с обновлениями библиотек.
	\item Кеширование изображений из сети:
		Реализация механизма кэширования сделала приложение более удобным
		для пользователей, позволяя им просматривать изображения даже
		при отсутствии интернет-соединения.
	\item Выполнение практической работы \No\,8:
		Переработка существующего приложения с интеграцией FastAPI
		для загрузки изображений продемонстрировала умение работать
		с серверной частью и API.
\end{itemize}

В результате работы было создано приложение,
которое не только соответствует заданным требованиям,
но и демонстрирует возможности кэширования и работы с сетевыми ресурсами.
Практическая работа позволила расширить навыки
в разработке мобильных приложений и работе с API,
что является важным аспектом в современном программировании.
Полученные знания и опыт будут полезны в дальнейшем
для создания более сложных и функциональных приложений.

