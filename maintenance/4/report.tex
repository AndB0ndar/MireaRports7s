\section*{Цель практической работы}
\addcontentsline{toc}{section}{Цель практической работы}

\textbf{Цель работы:} приобретение практических умений
и навыков работы с программным анализатором протоколов Wireshark.

\textbf{Задания:}

\begin{enumerate}
	\item Подготовка к работе.
	\item Захват трафика.
	\item Фильтрация и поиск кадров (пакетов).
	\item Экспорт в файл и печать полученной информации.
	\item Анализ кадра Ethernet и сообщения ARP в нём.
	\item Анализ протоколов IPv4 и ICMPv4.
	\item Анализ сообщений транспортного и прикладного уровней.
\end{enumerate}

\clearpage

\section*{Выполнение практической работы}
\addcontentsline{toc}{section}{Выполнение практической работы}

\section{Подготовка к работе}

Запустите менеджер виртуальных машин VirtualBox
на хост-компьютере (реальном).

В программе VirtualBox откройте предложенный образ виртуального (гостевого)
компьютера с предустановленной ОС Microsoft Windows \rref{fig:vm:windows}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 15-23-52}
	\caption{ОС Microsoft Windows в VirtualBox}
	\label{fig:vm:windows}
\end{image}

На гостевом компьютере установите анализатор Wireshark
(при этом установится и необходимая библиотека WinPCap).

Запустите Wireshark и разверните окно приложения на весь экран
\rref{fig:wireshark}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 15-23-52}
	\caption{Приложение Wireshark}
	\label{fig:wireshark}
\end{image}

В окне Wireshark выберите в меню раздел \textbf{Захват \rarrow Опции},
снимите флажок <<Включить смешанный режим для всех интерфейсов>>
\rref{fig:wrsh:capture}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 15-23-52}
	\caption{Окно опции захвата}
	\label{fig:wrsh:capture}
\end{image}

Нажмите на кнопку \textbf{<<Управлять Интерфейсами...>>}
и оставьте флажок только на \textbf{<<Подключение по локальной сети>>}.
Важно не ошибиться в выборе сетевого адаптера,
иначе запись кадров будет производиться из другого канала (сегмента сети)
\rref{fig:wrsh:capture:local}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-13-39}
	\caption{Выбор локальной сети}
	\label{fig:wrsh:capture:local}
\end{image}

Диалоговое окно \textbf{<<Опции захвата>>}
позволяет настроить дополнительные параметры захвата:

\begin{enumerate}
	\item Поле <<Фильтр для захвата выбранных интерфейсов>>
		--- экономит объем буфера, сразу же отбрасывая лишний трафик,
		что, в свою очередь, увеличивает нагрузку на CPU.
		В большинстве случаев запись лучше производить без фильтрации,
		т.к. иначе могут быть потеряны важные кадры
		или из-за ошибочного фильтра, или из-за перегруженности CPU.
	\item Группа параметров <<Захватывать в постоянный файл>>
		--- запись захвата в файл (полезно при длительном по времени захвате).
	\item Параметры <<Автоматически остановить захват после…>>
		--- условия автоматического завершения захвата.
	\item <<Показать опции>> --- отображение пакетов в реальном времени
		и автоматический скроллинг окна информации.
	\item <<Разрешение имен>> --- разрешение имен на физическом,
		сетевом и транспортном уровнях.
\end{enumerate}

\section{Захват трафика}

Откройте на гостевой машине командную строку
(\textbf{Пуск \rarrow Выполнить... \rarrow cmd.exe}),
в которой выполните команду \rref{fig:wnd:ipconfig},
для отображения текущих настроек TCP/IP: \texttt{ipconfig /all}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-16-17}
	\caption{Вывод команды ipconfig}
	\label{fig:wnd:ipconfig}
\end{image}

Запомните (зафиксируйте) IP-адрес DNSсервера.
Выполните следующую команду:\texttt{arp -d} \rref{fig:wnd:arp}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-16-35}
	\caption{Вывод команды arp}
	\label{fig:wnd:arp}
\end{image}

При этом будет осуществлена очистка ARP-таблицы (кэша)
соответствий IP- и MACадресов соседних хостов.
Убедитесь в этом, выполнив ту же команду \texttt{arp}, но с ключом \texttt{-a}.

В окне Wireshark выполните команду меню \textbf{Захват \rarrow Старт}
(или на панели инструментов значок <<Начать захват пакетов>>).
Вид окна Wireshark изменится --- оно разделится на 3 части
\rref{fig:wrsh:trafic}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-17-52}
	\caption{Окно Wireshark во время и после захвата трафика}
	\label{fig:wrsh:trafic}
\end{image}

Вернитесь в командную строку гостевого компьютера
и выполните команду: \texttt{ping <IP-addr>}.
Здесь IP-addr --- зафиксированный ранее адрес DNS-сервера
(угловые скобки при вводе не нужны!).
Сетевая утилита \texttt{ping}
по протоколу ICMP отправит 4 эхо запроса на указанный адрес
и отобразит пользователю информацию о получении соответствующих эхо-ответов.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-20-19}
	\caption{Выполнение команды ping}
	\label{fig:wnd:ping}
\end{image}


По завершении работы утилиты \texttt{ping}
остановите захват \rref{fig:wrsh:ping},
выполнив в окне Wireshark команду меню \textbf{Захват \rarrow Стоп}
(или на панели инструментов значок <<Остановить захват пакетов>>).

Три области окна Wireshark сверху вниз \rref{fig:wrsh:ping}:
\textbf{Packet List} --- список кадров,
\textbf{Packet Details} --- детализация выбранного в первой области кадра,
\textbf{Packet Bytes} --- шестнадцатеричное байтовое представление
выбранного кадра.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-23-30}
	\caption{Окно Wireshark во время и после захвата трафика}
	\label{fig:wrsh:ping}
\end{image}

Отображенный программой список из 10 кадров узнаваем и легко объясним:

\begin{enumerate}
	\item широковещательный (broadcast)
		Ethernet-кадр с ARP-запросом на разрешение указанного
		в команде \texttt{ping} IP-адреса в физический МАС-адрес
		(указанный IP-адрес принадлежит текущей подсети);
	\item полученный кадр с ARP-ответом от соответствующего узла
		на MAC-адрес текущего сетевого интерфейса;
	\item отправленный IPv4-пакет с эхо-запросом (протокол ICMP)
		от утилиты \texttt{ping};
	\item полученный от опрашиваемого узла IPv4-пакет с эхо-ответом
		(протокол ICMP)
\end{enumerate}

Строчки 5-10 в списке --- это три пары повторных эхо-запросов и эхо-ответов,
созданных утилитой \texttt{ping} (всего за сеанс – 4).

\section{Фильтрация и поиск кадров (пакетов)}

С помощью фильтра
(поле <<Применить дисплейный фильтр...>> на панели инструментов)
отобразите только данные протокола ARP \rref{fig:wrsh:filter:arp}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-42-33}
	\caption{Фильтрация по протоколу ARP}
	\label{fig:wrsh:filter:arp}
\end{image}

С помощью кнопки <<Очистить дисплейный фильтр...>> сбросьте текущий фильтр.
Аналогично отобразите только пакеты протокола ICMP \rref{fig:wrsh:filter:icmp}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-43-46}
	\caption{Фильтрация по протоколу ICMP}
	\label{fig:wrsh:filter:icmp}
\end{image}

В списке захваченных пакетов выделите любой IP-пакет.
В области детализации раскройте список полей заголовка этого пакета,
в нём найдите и выделите поле <<Time to live>> (TTL, время жизни).
В строке состояния окна Wireshark найдите написание соответствующего
этому полю параметра \rdref{fig:wrsh:field:ttl}{fig:wrsh:filter:ttl}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-50-13}
	\caption{Поле <<Time to live>>}
	\label{fig:wrsh:field:ttl}
\end{image}

\begin{image}
	\includegrph{Screenshot from 2024-11-04 16-56-52}
	\caption{Фильтрация по <<Time to live>>}
	\label{fig:wrsh:filter:ttl}
\end{image}

\paragraph{Смысл всех фильтров из таблицы}

Эта таблица содержит фильтры для анализа сетевых пакетов в Wireshark,
которые позволяют выделять определенные пакеты на основе различных условий.
Вот пояснение для каждой команды:

\begin{enumerate}
	\item \textbf{== (равенство)}:
		Используется для фильтрации пакетов,
		где значение поля равно указанному значению.  
	\item \textbf{!= (не равно)}:
		Отображает пакеты,
		где значение поля не совпадает с указанным значением.  
	\item \textbf{< (меньше чем)}:
		Показывает пакеты, у которых значение поля меньше заданного значения.  
	\item \textbf{> (больше чем)}:
		Показывает пакеты, у которых значение поля больше заданного значения.  
	\item \textbf{<= (меньше или равно)}:
		Отображает пакеты,
		у которых значение поля меньше или равно указанному значению.  
	\item \textbf{>= (больше или равно)}:
		Отображает пакеты,
		у которых значение поля больше или равно указанному значению.  
	\item \textbf{matches (регулярные выражения)}:
		Позволяет фильтровать пакеты по совпадению с регулярными выражениями.  
	\item \textbf{contains (содержит)}:
		Фильтрует пакеты, если указанное поле содержит определенное значение
		(строку или часть строки).  
\end{enumerate}

Эти фильтры помогают сосредоточиться на интересующих пакетах,
исключая ненужные данные при анализе сетевого трафика.

Последовательно примените фильтры \texttt{!(ip.addr == X.X.X.X)}
\rref{fig:wrsh:filter:!ip}
и \texttt{ip.addr ! = X.X.X.X}
\rref{fig:wrsh:filter:ip!}
(используйте вместо X.X.X.X соответственно
IP-адрес вашего виртуального компьютера).

\begin{image}
	\includegrph{Screenshot from 2024-11-04 17-35-03}
	\caption{!(ip.addr == X.X.X.X) фильтрация}
	\label{fig:wrsh:filter:!ip}
\end{image}

\begin{image}
	\includegrph{Screenshot from 2024-11-04 17-35-17}
	\caption{ip.addr != X.X.X.X фильтрация}
	\label{fig:wrsh:filter:ip!}
\end{image}

\texttt{!(ip.addr == X.X.X.X)} --- отфильтровывает все пакеты,
в которых ни один из IP-адресов (источник или назначение) не равен X.X.X.X.
Если хотя бы одно из полей \texttt{ip.addr} содержит X.X.X.X,
пакет будет исключен.

\texttt{ip.addr != X.X.X.X} --- более гибкий фильтр,
который пропускает пакеты, если хотя бы один из IP-адресов не равен X.X.X.X.
Это может привести к тому,
что некоторые пакеты с X.X.X.X в одном из полей
(источник или назначение) будут отображаться, если другое поле отличается.

В списке кадров (пакетов) отобразите все,
кроме сообщений ICMP \rref{fig:wrsh:filter:!icmp}.
В необходимое выражение для фильтрации: \texttt{!icmp}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 18-07-24}
	\caption{Все пакеты, кроме сообщений ICMP}
	\label{fig:wrsh:filter:!icmp}
\end{image}

С помощью окна поиска найдите предыдущий кадр (перед текущим) по фильтру
\texttt{icmp.type == 0} \rref{fig:wrsh:filter:icmp:type:0}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 18-26-59}
	\caption{Фильтрация по icmp.type == 0}
	\label{fig:wrsh:filter:icmp:type:0}
\end{image}

Фильтр \texttt{icmp.type == 0} используется
для поиска пакетов ICMP (Internet Control Message Protocol),
у которых тип сообщения равен 0.
В ICMP тип сообщения определяет, какого рода данные
или информация передаются в пакете.

Значение 0 обозначает ICMP-сообщение типа <<Echo Reply>> (ответ на запрос эхо).
Это сообщение является ответом на запрос ICMP типа 8,
который называется "Echo Request" (запрос эхо).

Найдите кадр по строке <<\texttt{reply}>> \rref{fig:wrsh:filter:icmp:seq}:
\begin{enumerate}
	\item следующий за текущим в области списка кадров;
	\item предыдущий (перед текущим) в области детализации.
\end{enumerate}

\begin{image}
	\includegrph{Screenshot from 2024-11-04 18-26-59}
	\caption{Фильтрация по icmp.type == 0}
	\label{fig:wrsh:filter:icmp:seq}
\end{image}

Пометьте кадр, содержащий пакет с четвёртым эхо-запросом,
созданным утилитой \texttt{ping} \rref{fig:wrsh:mark}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-02-07}
	\caption{Пометка пакета}
	\label{fig:wrsh:mark}
\end{image}

Расположите содержимое кадров 3 и 4
в отдельных окнах по примеру \rref{fig:wrsh:window:split}.
Обоснуйте, исходя из содержимого этих кадром, что они взаимосвязаны.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-03-44}
	\caption{Кадры в отдельных окнах}
	\label{fig:wrsh:window:split}
\end{image}

\section{Экспорт в файл и печать полученной информации}

Сохраните содержимое только первого захваченного кадра с сообщением ARP
в файл с именем \texttt{arp.txt} на \textbf{Рабочий Стол}
или в любую другую папку \rref{fig:wrsh:save:arp}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-10-28}
	\caption{Диалоговое окно экспорта кадров arp}
	\label{fig:wrsh:save:arp}
\end{image}

Сохраните в файл с именем \texttt{ping.txt}
весь трафик утилиты \texttt{ping} \rref{fig:wrsh:save:ping}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 20-12-33}
	\caption{Диалоговое окно экспорта кадров ping}
	\label{fig:wrsh:save:ping}
\end{image}

\section{Анализ кадра Ethernet и сообщения ARP в нём}

С помощью команды меню \textbf{Анализ \rarrow Разрешенные протоколы}
откройте диалоговое окно выбора протоколов для анализа.
Снимите флажок в строке <<IPv4>>, нажмите <<Ok>>.
Таким образом будет отключен анализ протокола IPv4
\rref{fig:wrsh:enabled:protocols}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-24-26}
	\caption{Диалоговое окно выбора протоколов для анализа}
	\label{fig:wrsh:enabled:protocols}
\end{image}

Обратите внимание, как изменилось содержимое областей списка кадров
и детализации в окне программы Wireshark
\rref{fig:wrsh:enabled:protocols:change}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-27-25}
	\caption{Изменение областей Wireshark}
	\label{fig:wrsh:enabled:protocols:change}
\end{image}

Отобразите в соседних окнах первый кадр с ARP-запросом
и второй кадр с ARPответом
\rdref{fig:wrsh:arp:diff}{fig:wrsh:arp:diff:3}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-36-02}
	\caption{Первый кадр и второй кадр с ARP}
	\label{fig:wrsh:arp:diff}
\end{image}
\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-36-56}
	\caption{Первый кадр и второй кадр с ARP}
	\label{fig:wrsh:arp:diff:1}
\end{image}
\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-37-18}
	\caption{Первый кадр и второй кадр с ARP}
	\label{fig:wrsh:arp:diff:2}
\end{image}
\begin{image}
	\includegrph{Screenshot from 2024-11-04 19-40-33}
	\caption{Первый кадр и второй кадр с ARP}
	\label{fig:wrsh:arp:diff:3}
\end{image}

В отчете ответьте на следующие вопросы:

\begin{enumerate}
	\item Какое значение поля <<тип протокола>>
		в кадре Ethernet указывает на протокол ARP?\par
		В поле <<тип протокола>> кадра Ethernet
		указано значение 0x0806,
		что указывает на использование протокола ARP.
	\item По какому MAC-адресу отправлен запрос ARP?\par
		Запрос ARP отправлен от MAC-адреса 08:00:27:34:2d:dc.
	\item По какому MAC-адресу отправлен ответ ARP?\par
		Ответ ARP отправлен от MAC-адреса 0a:00:27:00:00:00.
	\item Каким полем идентифицируются запрос и ответ ARP?\par
		Запрос и ответ ARP идентифицируются полем Opcode (код операции).
		Значение 1 соответствует запросу (ARP Request),
		а значение 2 --- ответу (ARP Reply).
	\item В каких полях в сообщении ARP передан запрос вашего узла?\par
		В сообщении ARP, запрос передан в следующих полях:
		\begin{itemize}
			\item Sender MAC address: 08:00:27:34:2d:dc;
			\item Sender IP address: 192.168.56.104;
			\item Target MAC address: 00:00:00:00:00:00;
				(так как MAC-адрес еще неизвестен);
			\item Target IP address: 192.168.56.1
				(это IP-адрес целевого узла, чей MAC-адрес запрашивается).
		\end{itemize}
	\item В каких полях в сообщении ARP передан ответ вашему узлу?\par
		В сообщении ARP, ответ передан в следующих полях:
		\begin{itemize}
			\item Sender MAC address: 0a:00:27:00:00:00;
			\item Sender IP address: 192.168.56.1
				(это IP-адрес целевого узла, отправившего ответ);
			\item Target MAC address: 08:00:27:34:2d:dc
				(MAC-адрес запрашивающего узла);
			\item Target IP address: 192.168.56.104
				(IP-адрес узла, отправившего запрос).
		\end{itemize}
\end{enumerate}

Откройте файл \texttt{arp.txt} в любом текстовом процессоре.
Выделите в байтовом представлении кадра все поля заголовка
Ethernet каждый своим цветом:

\begin{itemize}
	\item Destination MAC Address (MAC-адрес получателя)
		FF:FF:FF:FF:FF:FF указывает на широковещательный кадр,
		который предназначен всем устройствам в сети.
	\item Source MAC Address (MAC-адрес отправителя)
		08:00:27:34:2d:dc --- это MAC-адрес отправителя кадра,
		устройства, которое отправило этот пакет.
	\item EtherType (Тип протокола)
		0x0806 указывает, что протокол верхнего уровня --- ARP
		(Address Resolution Protocol).
\end{itemize}

\begin{image}
	\includegrph{Screenshot from 2024-11-06 22-20-26}
	\caption{Поля заголовка Ethernet}
	\label{fig:wrsh:arp:txt}
\end{image}

\section{Анализ протоколов IPv4 и ICMPv4}

Включите анализ протокола IPv4 \rref{fig:wrsh:ipv4}
и ответьте на следующие вопросы:

\begin{enumerate}
	\item Какие IP-адреса отображаются для узлов,
		участвующих в обмене по протоколу IP? \par
		\begin{itemize}
			\item 192.168.56.104
				(отправитель ICMP-запросов и адрес назначения для SSDP)
			\item 192.168.56.1
				(адрес назначения ICMP-запросов и отправитель SSDP-запросов)
			\item 224.0.0.252 (назначение для LLMNR-запросов)
			\item 239.255.255.250 (назначение для SSDP-запросов)
			\item 224.0.0.251 (назначение для MDNS-запросов)
		\end{itemize}
		IP-адреса 192.168.56.104 и 192.168.56.1
		представляют собой локальные узлы, которые обмениваются сообщениями.
	\item Какие MAC-адреса имеют узлы, участвующие в обмене по протоколу IP?
		\begin{itemize}
			\item 08:00:27:34:2d --- этот MAC-адрес присутствует
				на интерфейсе узла с IP-адресом 192.168.56.104
				(он указан как источник в кадрах).
			\item 08:00:27:00:00:00 --- этот MAC-адрес указан
				в поле назначения для всех отображенных IP-пакетов.
		\end{itemize}
	\item Какой IP-адрес имеет узел с MAC-адресом,
		присутствующим во всех кадрах с протоколом IP?
		Какова роль этого узла? \par
		MAC-адрес 08:00:27:00:00:00 присутствует во всех кадрах
		как адрес назначения.
		Он, скорее всего, принадлежит узлу с IP-адресом 192.168.56.1. \par
		Роль этого узла, вероятно, заключается в том,
		что он является шлюзом или устройством назначения для трафика,
		генерируемого узлом 192.168.56.104.
\end{enumerate}

\begin{image}
	\includegrph{Screenshot from 2024-11-04 20-05-08}
	\caption{Фильтрация по IPv4}
	\label{fig:wrsh:ipv4}
\end{image}

Аналогично заданию 23 выделите в текстовом процессоре различными цветами
поля заголовка IPv4 в шестнадцатеричном представлении пакета.
\rref{fig:wrsh:arp:txt}:

\begin{enumerate}
	\item Version \& IHL (45): 4 --- IPv4, 5 --- длина заголовка (20 байт).
	\item Type of Service (00): Качество обслуживания не задано.
	\item Total Length (00 3c): Общая длина пакета --- 0x003c = 60 байт.
	\item Identification (00 38): Идентификатор пакета --- 0x0038.
	\item Flags \& Fragment Offset (00 00):
		Флаги и смещение фрагмента (значение 0), фрагментирование не требуется.
	\item Time to Live (80):
		TTL равен 0x80 = 128,
		что обычно соответствует начальной TTL для пакетов.
	\item Protocol (01): Протокол верхнего уровня --- 0x01, то есть ICMP.
	\item Header Checksum (48 cf): Контрольная сумма заголовка.
	\item Source IP (c0 a8 38 68): IP-адрес отправителя --- 192.168.56.104.
	\item Destination IP (c0 a8 38 01): IP-адрес получателя --- 192.168.56.1.
\end{enumerate}

\begin{image}
	\includegrph{Screenshot from 2024-11-04 20-15-30}
	\caption{Поля заголовка IPv4}
	\label{fig:wrsh:ipv4:txt}
\end{image}

Захватите сетевой трафик вашего виртуального узла
при трассировке маршрута к поисковой системе Google
(утилиты \texttt{tracert} или \texttt{pathping})
и ответьте в отчёте на следующие вопросы \rref{fig:wrsh:google:ping}:

\begin{enumerate}
	\item Почему MAC-адреса назначения
		и источника у всех кадров одинаковы и чьи это адреса? \par
		MAC-адреса одинаковы на каждом шаге трассировки,
		потому что на каждом маршрутизаторе меняется только MAC-адрес
		назначения (указан на следующий маршрутизатор),
		а источник остаётся тот же --- сетевой интерфейс
		вашего виртуального узла.
	\item Почему узлы присылают ICMP сообщение <<type 11>>? \par
		ICMP <<type 11>> (Time Exceeded) отправляется,
		когда TTL (Time to Live) пакета истекает,
		и пакет не может быть доставлен.
		Это помогает предотвратить бесконечные циклы пакетов в сети.
	\item Какова структура ICMP сообщения <<type 11>>?
		\begin{itemize}
			\item Тип --- 1 байт (11).
			\item Код --- 1 байт (обычно 0).
			\item Контрольная сумма --- 2 байта.
			\item Оригинальный пакет --- первые 64 байта исходного пакета.
		\end{itemize}
	\item Какие поля ICMP одинаковы,
		а какие различны в последних трех запросах? \par
		Общие поля ICMP:
		\begin{itemize}
			\item Тип: зависит от сообщения
				(Echo Request --- 8, Echo Reply --- 0, Time Exceeded --- 11).
			\item Контрольная сумма: для проверки целостности.
			\item Идентификатор и Последовательный номер:
				для связи запросов и ответов.
		\end{itemize}
		Различные поля:
		\begin{itemize}
			\item Код: в Echo Request/Reply --- 0, в Time Exceeded --- 0.
			\item Данные: в Echo Request/Reply --- содержат метки времени,
				в Time Exceeded --- часть оригинального пакета.
		\end{itemize}
\end{enumerate}

\begin{image}
	\includegrph{Screenshot from 2024-11-04 20-38-27}
	\caption{Трассировка маршрута к поисковой системе Google}
	\label{fig:wrsh:google:ping}
\end{image}

Захватите сетевой трафик функционирования утилиты\texttt{ping} 
при проверке доступности сервера Google с параметром <<r>>,
равным 5 \rref{fig:wrsh:google:ping:r5}.
Сохраните данные в файле с именем \texttt{ping-r5.txt}.

Ответьте на следующие вопросы:

\begin{enumerate}
	\item Поясните назначение параметра -r в команде \texttt{Ping}. \par
		Параметр -r в команде ping используется для записи маршрута,
		который проходит пакет, через до 9 промежуточных узлов
		(маршрутизаторов). Когда используется ping -r 5,
		утилита запрашивает информацию о маршруте через 5 промежуточных узлов,
		которые пакет проходит на пути к серверу.
		В ответе будет указана информация о каждом маршрутизаторе на маршруте.
	\item Каким образом в кадрах передается информация о маршруте? \par
		Информация о маршруте передается в полях заголовка ICMP.
		Когда используется параметр -r,
		в ICMP Echo Request и Echo Reply добавляются маршруты
		(IP-адреса узлов), через которые проходил пакет.
		Эти адреса включаются в поле маршрута в заголовке ICMP,
		где указывается последовательность промежуточных маршрутизаторов,
		через которые прошел пакет.
	\item Почему значение параметра -r в команде \texttt{Ping}
		не может быть больше 9? \par
		Значение параметра -r ограничено 9 из-за ограничений в структуре ICMP.
		Поле маршрута в заголовке ICMP ограничено 9 адресами маршрутизаторов.
		Если попытаться указать большее количество,
		это приведет к переполнению поля,
		что делает невозможным корректную передачу информации о маршруте.
	\item Каким образом ведут себя значения полей идентификатора
		и последовательного номера в заголовке ICMP захваченных кадров? \par
		\begin{itemize}
			\item Идентификатор и Последовательный номер используются
				для связи запросов и ответов.
				В каждом запросе ping будет свой уникальный идентификатор,
				который будет одинаковым в соответствующих ответах.
			\item Идентификатор остается постоянным для всей серии запросов.
			\item Последовательный номер увеличивается
				с каждым отправленным запросом (например, с 1 до N),
				чтобы различать ответы на разные запросы
				в рамках одного сеанса.
		\end{itemize}
\end{enumerate}

\begin{image}
	\includegrph{Screenshot from 2024-11-04 20-44-43}
	\caption{Ping к поисковой системе Google}
	\label{fig:wrsh:google:ping:r5}
\end{image}

\section{Анализ сообщений транспортного и прикладного уровней}

Захватите сетевой трафик вашего узла при обращении в браузере к любой вебстранице в сети Интернет \rref{fig:wrsh:web}.

\begin{image}
	\includegrph{Screenshot from 2024-11-04 20-49-26}
	\caption{Сетевой трафик при обращении к веб-странице}
	\label{fig:wrsh:web}
\end{image}

Выделите в текстовом процессоре различными цветами
поля заголовка TCP-сегмента (сообщения транспортного уровня).
Опишите значение этих полей в отчете \rref{fig:wrsh:tcp}:

\begin{enumerate}
	\item Source Port (Порт источника) 0xe7fe,
		что соответствует порту источника. В десятичном виде это 60030.
	\item Destination Port (Порт назначения) 0x01bb,
		что соответствует порту назначения. В десятичном виде это 443.
	\item Sequence Number (Номер последовательности) 0x834dd5cb,
		это номер последовательности сегмента,
		который указывает на байт данных,
		который передает этот сегмент в потоке.
	\item Acknowledgment Number (Номер подтверждения) 0x00000000,
		это значение указывает на отсутствие номера подтверждения,
		если флаг ACK не установлен.
	\item Data Offset (Размер заголовка) 0xa0, что означает,
		что размер заголовка TCP составляет 160 бит (или 20 байт).
	\item Reserved, Flags (Зарезервированные биты и флаги)
		\begin{itemize}
			\item Первые 3 бита --- это зарезервированные биты
				(все равны нулю).
			\item Последние 9 бит составляют флаги,
				где: 0x02 указывает, что установлен флаг SYN
				(сигнал начала соединения).
		\end{itemize}
	\item Window Size (Размер окна) 0xfd20, что соответствует размеру окна.
		В десятичном виде это 64768.
		Это значение используется для управления потоком
		и указывает максимальное количество байт,
		которое приемник готов принять.
	\item Checksum (Контрольная сумма) 0xbec4,
		это контрольная сумма заголовка и данных,
		которая используется для проверки целостности передаваемой информации.
	\item Urgent Pointer (Указатель на срочные данные) 0x0000,
		указывает на отсутствие срочных данных, так как флаг URG не установлен.
	\item Options (Опции) 02 04 05 a0 04 02 08 0a --- это опции TCP-заголовка.
		В данном случае:
		\begin{itemize}
			\item 02 04 05 a0: Maximum Segment Size (MSS) 1460 байт.
			\item 04 02: Window Scale Factor (шкала окна).
			\item 08 0a: SACK Permitted
				(разрешены блоки с подтверждением частичного получения).
		\end{itemize}
	\item Padding (Дополнение) 52 e3 ac 60 00 00 00 00 01 03 03 07.
		Это дополнительные данные, которые могут быть частью опций,
		выравнивающих длину заголовка TCP до кратности 32 бит.
\end{enumerate}

\begin{image}
	\includegrph{Screenshot from 2024-11-04 21-03-12}
	\caption{Поля заголовка TCP-сегмента}
	\label{fig:wrsh:tcp}
\end{image}

Отобразите в отчете содержимое HTTP-запроса
и HTTP-ответа веб-сервера \rref{fig:wrsh:http}.

\begin{image}
	\includegrph{Screenshot from 2024-11-06 22-58-00}
	\caption{Содержимое HTTP-запроса и HTTP-ответа}
	\label{fig:wrsh:http}
\end{image}

HTTP запрос состоит из трех основных частей:
строка запроса (request line), заголовок (message header)
и тело сообщения (entity body).
Тело сообщения не является обязательным параметром.
Между заголовком и телом есть пустая разделительная строка.

HTTP-запрос:

\begin{verbatim}
GET / HTTP/1.1
Host: www.lib.ru
Connection: keep-alive
User-Agent: Mozilla/5.0 (X11; Linux x86_64)
	AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,
	application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
\end{verbatim}

Описание полей:

\begin{itemize}
    \item \textbf{Метод}: GET
    \item \textbf{Ресурс}: /
    \item \textbf{Протокол}: HTTP/1.1
    \item \textbf{Host}: www.lib.ru
    \item \textbf{Connection}: keep-alive
    \item \textbf{User-Agent}: Mozilla/5.0 (X11; Linux x86\_64)
		AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36
    \item \textbf{Accept}: text/html, application/xhtml+xml,
		application/xml;q=0.9, image/webp, image/apng, *\/*;q=0.8
    \item \textbf{Accept-Encoding}: gzip, deflate
    \item \textbf{Accept-Language}: en-US, en;q=0.9
\end{itemize}

HTTP-ответ:

\begin{verbatim}
HTTP/1.1 304 Not Modified
Server: nginx/1.21.5
Date: Wed, 06 Nov 2024 19:56:10 GMT
Connection: keep-alive
Last-Modified: Wed, 06 Nov 2024 19:56:10 GMT
\end{verbatim}

Описание полей:

\begin{itemize}
    \item \textbf{Статус}: HTTP/1.1 304 Not Modified
    \item \textbf{Server}: nginx/1.21.5
    \item \textbf{Date}: Wed, 06 Nov 2024 19:56:10 GMT
    \item \textbf{Connection}: keep-alive
    \item \textbf{Last-Modified}: Wed, 06 Nov 2024 19:56:10 GMT
\end{itemize}

\clearpage

\section*{Вывод}
\addcontentsline{toc}{section}{Вывод}

В ходе практической работы по освоению программного анализатора протоколов Wireshark были приобретены практические умения и навыки, необходимые для анализа сетевого трафика. Работа охватывала различные этапы, начиная от подготовки к захвату трафика и заканчивая анализом сообщений транспортного и прикладного уровней. В процессе выполнения заданий были изучены основные функции программы, такие как захват трафика, фильтрация и поиск пакетов, а также экспорт и печать полученной информации.

Особое внимание было уделено анализу различных сетевых протоколов, таких как Ethernet, ARP, IPv4, ICMPv4, а также протоколов транспортного и прикладного уровней. Были проанализированы структуры пакетов, особенности их взаимодействия в сети, что позволило глубже понять процесс передачи данных в компьютерных сетях и выявить возможные проблемы в их работе.

В результате работы была получена ценная информация для диагностики и устранения сетевых неисправностей, а также улучшено понимание принципов функционирования различных сетевых протоколов и их взаимодействия. Wireshark является мощным инструментом для сетевого анализа, и приобретённые навыки будут полезны в дальнейшей профессиональной деятельности.


